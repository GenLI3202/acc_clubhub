---
// src/pages/[lang]/routes/index.astro
// éª‘è¡Œè·¯çº¿ - åˆ—è¡¨é¡µ (ç€‘å¸ƒæµå¸ƒå±€)

import BaseLayout from '../../../layouts/BaseLayout.astro';
import MasonryGrid from '../../../components/MasonryGrid.astro';
import MasonryCard from '../../../components/MasonryCard.astro';
import { getCollection } from 'astro:content';
import { locales, getLangFromEntry, t, type Locale } from '../../../lib/i18n';

export function getStaticPaths() {
  return locales.map((lang) => ({ params: { lang } }));
}

const { lang } = Astro.params as { lang: Locale };

const allRoutes = await getCollection('routes');
const langRoutes = allRoutes.filter(
  (entry) => getLangFromEntry(entry.filePath, 'routes') === lang
);
// æŒ‰éš¾åº¦æ’åº
const difficultyOrder = { easy: 1, medium: 2, hard: 3, expert: 4 };
const sortedRoutes = langRoutes.sort(
  (a, b) => difficultyOrder[a.data.difficulty] - difficultyOrder[b.data.difficulty]
);

const pageTitle = t(lang, 'nav.routes');

// éš¾åº¦æ ‡ç­¾ç¿»è¯‘
const difficultyLabels: Record<string, Record<string, string>> = {
  zh: { easy: 'ç®€å•', medium: 'ä¸­ç­‰', hard: 'å›°éš¾', expert: 'ä¸“å®¶' },
  en: { easy: 'Easy', medium: 'Medium', hard: 'Hard', expert: 'Expert' },
  de: { easy: 'Leicht', medium: 'Mittel', hard: 'Schwer', expert: 'Experte' },
};
---

<BaseLayout title={pageTitle} lang={lang}>
  <div class="page-title">
    <h1>ğŸ—ºï¸ {pageTitle}</h1>
    <p class="page-subtitle">
      {lang === 'zh'
        ? 'å¯æœç´¢è·¯çº¿æ•°æ®åº“ã€Strava/Komoot é“¾æ¥'
        : lang === 'de'
          ? 'Suchbare Routen, Strava/Komoot Links'
          : 'Searchable Routes, Strava/Komoot Links'}
    </p>
  </div>

  {sortedRoutes.length > 0 ? (
    <MasonryGrid>
      {sortedRoutes.map((entry) => (
        <MasonryCard
          href={`/${lang}/routes/${entry.data.slug}`}
          title={entry.data.name}
          description={entry.data.region}
          cover={entry.data.cover}
          meta={`${entry.data.distance}km Â· ${entry.data.elevation}m â†‘ Â· ${difficultyLabels[lang][entry.data.difficulty]}`}
          seed={entry.data.slug}
        />
      ))}
    </MasonryGrid>
  ) : (
    <div class="empty-state">
      <p>{t(lang, 'content.noContent')}</p>
    </div>
  )}
</BaseLayout>

<style>
  .empty-state {
    text-align: center;
    padding: var(--space-xl);
    color: #666;
    background: rgba(255, 255, 255, 0.5);
    border: 2px dashed var(--color-border-rough);
    border-radius: var(--radius-aero);
    margin-top: var(--space-lg);
  }
</style>
