---
// src/pages/[lang]/events/index.astro
// ÊÖïÂüéÊó•Â∏∏ - Ê¥ªÂä®È°µÈù¢ (Layer 4 ÂÆûÁé∞)

import BaseLayout from '../../../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';
import { locales, getLangFromEntry, t, type Locale } from '../../../lib/i18n';
import { SearchBar } from '../../../components/search/SearchBar';
import EventsPage from '../../../components/content/EventsPage';

export function getStaticPaths() {
  return locales.map((lang) => ({ params: { lang } }));
}

const { lang } = Astro.params as { lang: Locale };
const pageTitle = t(lang, 'nav.events');

// Fetch events
const allEvents = await getCollection('events');
const langEvents = allEvents.filter(
  (entry) => getLangFromEntry(entry.filePath, 'events') === lang
);
const sortedEvents = langEvents.sort(
  (a, b) => new Date(b.data.date).valueOf() - new Date(a.data.date).valueOf()
);
---

<BaseLayout title={pageTitle} lang={lang}>
  <div class="page-title-header">
    <div class="title-content">
      <h1>üö¥ {pageTitle}</h1>
      <p class="page-subtitle">
        {lang === 'zh'
          ? 'Social Ride„ÄÅTraining Day„ÄÅÊ¥ªÂä®Êä•Âêç'
          : lang === 'de'
            ? 'Social Ride, Training Day, Anmeldung'
            : 'Social Ride, Training Day, Registration'}
      </p>
    </div>
    <div class="inline-search-container">
      <SearchBar 
        client:idle 
        lang={lang} 
        translations={{
          placeholder: t(lang, 'search.placeholder'),
          noResults: t(lang, 'search.noResults')
        }}
        placeholder={t(lang, 'search.placeholder')}
      />
    </div>
  </div>

  <EventsPage 
    client:load 
    initialItems={sortedEvents} 
    lang={lang} 
  />
</BaseLayout>

<style>
  .page-title-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    flex-wrap: wrap;
    gap: var(--space-md);
    margin-bottom: var(--space-lg);
    border-bottom: 2px solid var(--color-border-rough);
    padding-bottom: var(--space-md);
  }

  .title-content {
    flex: 1;
    min-width: 280px;
  }

  .title-content h1 {
    margin-bottom: 0.5rem;
  }

  .inline-search-container {
    flex: 0 1 400px; /* Base width 400px, but can shrink */
    min-width: 300px;
    padding-top: 0.5rem; /* Align visual center with H1 roughly */
  }

  /* Override inner search bar styles to fit inline context if needed */
  .inline-search-container :global(.search-container) {
    width: 100%;
    max-width: 100%;
    box-shadow: none;
    background: transparent;
    border: none;
  }

  /* Responsive: Stack on mobile */
  @media (max-width: 768px) {
    .page-title-header {
      flex-direction: column;
    }
    .inline-search-container {
      width: 100%;
      flex: none;
    }
  }
</style>
